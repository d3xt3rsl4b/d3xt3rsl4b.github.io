<!doctype html><html lang="en"><head><meta charset="utf-8"><meta name="generator" content="Hexo 4.2.1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><title>when a chatbot meets arduino - D3xt3r&#039;s Laboratory</title><meta description="If you have worked with IOT projects that integrate with other web apps or any other types of system you probably must be dealing with 10 different languages and frameworks, it’s painful. It also gets"><meta property="og:type" content="article"><meta property="og:title" content="when a chatbot meets arduino"><meta property="og:url" content="https://www.taintedbits.com/2017/08/20/when-a-chatbot-meets-arduino/"><meta property="og:site_name" content="D3xt3r&#039;s Laboratory"><meta property="og:description" content="If you have worked with IOT projects that integrate with other web apps or any other types of system you probably must be dealing with 10 different languages and frameworks, it’s painful. It also gets"><meta property="og:locale" content="en_US"><meta property="og:image" content="https://www.taintedbits.com/2017/08/20/when-a-chatbot-meets-arduino/light-dependent-resistor-arduino-schematics.png"><meta property="article:published_time" content="2017-08-20T13:20:51.000Z"><meta property="article:modified_time" content="2020-01-27T12:00:47.844Z"><meta property="article:author" content="D3xt3r"><meta property="article:tag" content="Arduino"><meta property="article:tag" content="Chat Bots"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="/2017/08/20/when-a-chatbot-meets-arduino/light-dependent-resistor-arduino-schematics.png"><meta property="twitter:creator" content="@0xd3xt3r"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.taintedbits.com/2017/08/20/when-a-chatbot-meets-arduino/"},"headline":"D3xt3r's Laboratory","image":["https://www.taintedbits.com/2017/08/20/when-a-chatbot-meets-arduino/light-dependent-resistor-arduino-schematics.png"],"datePublished":"2017-08-20T13:20:51.000Z","dateModified":"2020-01-27T12:00:47.844Z","author":{"@type":"Person","name":"D3xt3r"},"description":"If you have worked with IOT projects that integrate with other web apps or any other types of system you probably must be dealing with 10 different languages and frameworks, it’s painful. It also gets"}</script><link rel="alternative" href="/atom.xml" title="D3xt3r&#039;s Laboratory" type="application/atom+xml"><link rel="icon" href="/images/logo-header.png"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/railscasts.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=UA-128181439-1" async></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-128181439-1")</script></head><body class="is-2-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/images/logo-header.png" alt="D3xt3r&#039;s Laboratory" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">Home</a><a class="navbar-item" href="/archives">Archives</a><a class="navbar-item" href="/categories">Categories</a><a class="navbar-item" href="/tags">Tags</a><a class="navbar-item" href="/publications">Publications</a><a class="navbar-item" href="/cve">CVE</a><a class="navbar-item" href="/about">About</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="Catalogue" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="Search" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta size-small is-uppercase level is-mobile"><div class="level-left"><time class="level-item" datetime="2017-08-20T13:20:51.000Z" title="2017-08-20T13:20:51.000Z">2017-08-20</time><span class="level-item"><a class="link-muted" href="/categories/IOT/">IOT</a></span><span class="level-item">12 minutes read (About 1840 words)</span></div></div><h1 class="title is-3 is-size-4-mobile">when a chatbot meets arduino</h1><div class="content"><p>If you have worked with IOT projects that integrate with other web apps or any other types of system you probably must be dealing with 10 different languages and frameworks, it’s painful. It also gets chaotic to maintain the code base in different language and repository. In such areas of troubles, Nodejs/javascript gives out some ray of hope. In this post, we will create a chat bot that will be able to communicate with Arduino board and its connected sensor and this entire project will be in Nodejs just one language javascript. Nodejs is chosen because it excels at handles I/O operations.</p><a id="more"></a><h3><span id="motivation">Motivation</span></h3><p>I have done a couple of chat bot projects, the amazing thing about chat bots is their ease of availability. You don’t have to install another app/plugin on your phone/computer it’s available right in your messenger app just like a jinni waiting to fulfill your wish. And I have also done some side projects on Arduino board, integrating Arduino projects with other systems can be a little tricky, you can have a sensor reading been displayed on a 16x2 LCD, that is cool but it’s can be super cool if it could be delivered in you Messenger app with so suggestions on what action could we do next like if light sensor show reading of 10% or below and its evening then turn on the light or if temperature drops below 10 C the turn on the heater etc. In this post, I have tried to mix the concept of chat bots and Arduino interacting physical world.</p><h3><span id="software-required">Software required</span></h3><ol><li><strong>Messager platform</strong> - Telegram bot API’s are simple to use and there are nice npm modules available which can help us to do quick prototyping.</li><li><strong>Nodejs IOT framework</strong> - there are several frameworks available like breakoutjs, firmatajs and johnny-five, but I am going to use <strong>johnny-five</strong> no specific reason.</li><li><strong>Arduino IDE</strong> - Arduino Standard firmware is not going to work with the johnny-five library, we need StardardFirmataPlus Arduino firmware to communicate with the johnny-five library. johnny-five uses Firmata protocol to communicate with the microcontroller, I will get back to this in the later part of the post.</li></ol><h3><span id="hardware-required">Hardware required</span></h3><ol><li>Arduino Uno</li><li>Light dependent resistor</li><li>Breadboard</li><li>Jumper wires</li></ol><p>Plan of the post is not to create some sophisticated hardware application but just to illustrate the concept, so one sensor is enough for that.</p><h3><span id="basic-project-setup">Basic project setup</span></h3><p>We are going to use a couple of Nodejs packages which are :</p><ol><li><strong>johnny-five</strong> - IOT framework as discussed before.</li><li><strong>node-telegram-bot-api</strong> - High-level wrapper for Telegram bot API’s that takes care of message polling etc, and give nice callback function just to deal with the incoming messages.</li></ol><p>To setup the project execute the commands below</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir iot-bot &amp;&amp; <span class="built_in">cd</span> iot-bot;</span><br><span class="line">npm init -y</span><br><span class="line">npm install --save johnny-five</span><br><span class="line">npm install --save node-telegram-bot-api</span><br></pre></td></tr></table></figure><h3><span id="setting-up-arduino-for-johnny-five">Setting up Arduino for johnny-five</span></h3><p>To use johnny-five with Arduino we have to upload StandardFirmataPlus firmware to Arduino. So what exactly is StandardFirmataPlus again? In simple terms it’s a general purpose sketch which you don’t program the explicitly sketch to read/write data for particular pins instead, the sketch is programmed to read commands from the host computer to which Arduino is connected and execute it. The command could be writing/reading data to/from Arduino pins. All this is done with a Firmata protocol. It is contrary to the traditional Arduino sketch we write that has all the logic on how to deal with sensor data. Logic is moved to the host computer instead, and a general purpose sketch is uploaded to Arduino that just knows how to deal with I/O pins.</p><p>To install <strong>StandardFirmataPlus</strong> firmware go to <strong>File &gt; Examples &gt; Firmata &gt; StandardFirmataPlus</strong> it will open up Arduino sketch upload the sketch to Arduino board. To test if everything went right execute the below javascript code on your host computer to which Arduino board is connected and you should get <em>Board is ready</em> printed on your terminal.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> five = <span class="built_in">require</span>(<span class="string">"johnny-five"</span>);</span><br><span class="line"><span class="keyword">var</span> board = <span class="keyword">new</span> five.Board();</span><br><span class="line"></span><br><span class="line">board.on(<span class="string">"ready"</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">"Board is ready"</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p><strong>Arduino Schematic diagram</strong></p><img src="/2017/08/20/when-a-chatbot-meets-arduino/light-dependent-resistor-arduino-schematics.png" title="Schematic of Arduino connected to light dependent resistor"><p>Getting console greeting is not enough, follow the below schematic to connect a light dependent resistor with Arduino board, javascript code below we will read the value of light sensor data from pin <strong>A0</strong> and print it on the console.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> five = <span class="built_in">require</span>(<span class="string">"johnny-five"</span>);</span><br><span class="line"><span class="keyword">var</span> board = <span class="keyword">new</span> five.Board();</span><br><span class="line"></span><br><span class="line">board.on(<span class="string">"ready"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Board is ready'</span>)</span><br><span class="line">  <span class="comment">// read the sensor data from analog pin 0</span></span><br><span class="line">  <span class="keyword">var</span> light = <span class="keyword">new</span> five.Light(<span class="string">"A0"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// change event is fired when there is a change in</span></span><br><span class="line">  <span class="comment">// value of the pin</span></span><br><span class="line">  light.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.level);</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * if the pin reading is between 10% to 30%</span></span><br><span class="line"><span class="comment">   * then there is definitely some strong light</span></span><br><span class="line"><span class="comment">   * source in the room.</span></span><br><span class="line"><span class="comment">   * the callback function is called if the pin</span></span><br><span class="line"><span class="comment">   * value is between range specifed below</span></span><br><span class="line"><span class="comment">   * late we will laverage this function for</span></span><br><span class="line"><span class="comment">   * chatbot notification</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  light.within([<span class="number">0.10</span>, <span class="number">0.30</span>], <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Lights are on'</span>)</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3><span id="setting-up-telegram-bot">Setting up Telegram Bot</span></h3><p>Till now we have handled the Arduino side of the project, we have to manage to pull the sensor data from Arduino into our Nodejs code, next we have to send it to Telegram messenger. But first, we have to setup Telegram bot. You need Bot token to use Telegram bot API’s you can follow <a href="https://core.telegram.org/bots#creating-a-new-bot">this official post</a> on how to create a bot and get bot token.</p><p>Once you have the bot token lets verify that you got things right, execute the javascript code below and fill the token variable with the bot token which you bot from @BotFather.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> TelegramBot = <span class="built_in">require</span>(<span class="string">'node-telegram-bot-api'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// paste the bot token you receive from @BotFather</span></span><br><span class="line"><span class="keyword">var</span> token = <span class="string">'YOUR_TELEGRAM_BOT_TOKEN'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> bot = <span class="keyword">new</span> TelegramBot(token, &#123;<span class="attr">polling</span>: <span class="literal">true</span>&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Listen for any kind of message.</span></span><br><span class="line">bot.on(<span class="string">'message'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// we will need chat id if we want to push the message</span></span><br><span class="line">    <span class="keyword">var</span> chatId = msg.chat.id;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Chat id of user : '</span>, chatId);</span><br><span class="line">    <span class="comment">// echo back the message</span></span><br><span class="line">    bot.sendMessage(chatId, <span class="string">'Got it chief!'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><h3><span id="hooking-up-arduino-with-chat-bot">Hooking up Arduino with Chat Bot</span></h3><p>Now that we are through with different components of the project it time that we hook everything together. The bot will send a notification to you if the value of the light dependent resistor is between 10% to 30 %. This range value (10-30%) was the reading of the sensor when the light was on in my room, so that’s what I am using, you can change it to any other value that suits your environment, threshold value depends lots of factor like the distance between the light source and the sensor so the value might differ for your settings. Another functionality will be reading light sensor value on when asked for, this can be done simply by storing the value of the sensor in the variable when a change event is fired this way we have the last changed value of light sensor, and when user ask’s for sensor reading send the value of the variable.</p><p>To receive notifications you have to subscribe by sending <strong>/subscribe</strong> command to the bot, if you interested to know the value of the sensor right away then type <strong>/light</strong> command and if you don’t want to receive the notification then type <strong>/unsubscribe</strong>. Telegram bot platform has commands functionality inbuilt so UI dropdown list shows up so you don’t have to type the whole word. And as you might have noticed commands starts with <strong>/</strong> which is also part of bot platform. The bot will send push message when the sensor value is within range.</p><p><strong>Bot commands summary :</strong></p><ol><li><strong>/light</strong> - Read the current value of light sensor</li><li><strong>/subscribe</strong> - Subscribe to list of user getting notifications.</li><li><strong>/unsubscribe</strong> - Unsubscribe to notifications if not interested.</li></ol><p>Below is the code for what we have discussed so far</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> five = <span class="built_in">require</span>(<span class="string">"johnny-five"</span>);</span><br><span class="line"><span class="keyword">var</span> TelegramBot = <span class="built_in">require</span>(<span class="string">'node-telegram-bot-api'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> token = <span class="string">'YOUR_TELEGRAM_BOT_TOKEN'</span>;</span><br><span class="line"><span class="comment">// fill this variable with the chatId of the use you want</span></span><br><span class="line"><span class="comment">// to send the message to</span></span><br><span class="line"><span class="keyword">var</span> chatIds = [];</span><br><span class="line"><span class="keyword">var</span> lightSensorValue = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> board = <span class="keyword">new</span> five.Board();</span><br><span class="line"><span class="keyword">var</span> bot = <span class="keyword">new</span> TelegramBot(token, &#123;</span><br><span class="line">  polling: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// send message to who so every ask for the value</span></span><br><span class="line">bot.onText(<span class="regexp">/\/light/</span>, (msg, match) =&gt; &#123;</span><br><span class="line">  <span class="keyword">var</span> chatId = msg.chat.id;</span><br><span class="line">  bot.sendMessage(chatId, <span class="string">'Light is at '</span> + (lightSensorValue * <span class="number">100</span>) + <span class="string">'%'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// subscribe to the list of users who wish to recieve light notifications</span></span><br><span class="line">bot.onText(<span class="regexp">/\/subscribe/</span>, (msg, match) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> chatId = msg.chat.id;</span><br><span class="line">    <span class="keyword">var</span> index = chatIds.indexOf(chatId);</span><br><span class="line">    <span class="keyword">if</span>(index == <span class="number">-1</span>)&#123;</span><br><span class="line">        chatIds.push(chatId);</span><br><span class="line">        bot.sendMessage(chatId, <span class="string">'You will recieve light notifications ;)'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bot.sendMessage(chatId, <span class="string">'You are already subscribed!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// unsubscribe the notifications</span></span><br><span class="line">bot.onText(<span class="regexp">/\/unsubscribe/</span>, (msg, match) =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> chatId = msg.chat.id;</span><br><span class="line">    <span class="keyword">var</span> index = chatIds.indexOf(chatId);</span><br><span class="line">    <span class="keyword">if</span>(index != <span class="number">-1</span>)&#123;</span><br><span class="line">        chatIds.splice(index, <span class="number">1</span>);</span><br><span class="line">        bot.sendMessage(chatId, <span class="string">'You have successfully unsubcribed.'</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        bot.sendMessage(chatId, <span class="string">'You are are not subscribed.'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * if the value of sensor is within range then</span></span><br><span class="line"><span class="comment"> * too many messages might get pushed in short span</span></span><br><span class="line"><span class="comment"> * of time to avoid this below logic has been included</span></span><br><span class="line"><span class="comment"> * to make sure that there is at least 10 min interval between</span></span><br><span class="line"><span class="comment"> * two notifications</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">var</span> spamControlOn = <span class="literal">true</span>;</span><br><span class="line">setInterval(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  spamControlOn = <span class="literal">true</span>;</span><br><span class="line">&#125;, <span class="number">1000</span> * <span class="number">60</span> * <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">board.on(<span class="string">"ready"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'Board is ready'</span>)</span><br><span class="line">  <span class="keyword">var</span> light = <span class="keyword">new</span> five.Light(<span class="string">"A0"</span>);</span><br><span class="line"></span><br><span class="line">  light.on(<span class="string">"change"</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    lightSensorValue = <span class="keyword">this</span>.level;</span><br><span class="line">    <span class="keyword">if</span> (five.Fn.inRange(<span class="keyword">this</span>.level, <span class="number">0.10</span>, <span class="number">0.30</span>)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (spamControlOn &amp;&amp; chatIds.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        chatIds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">chatId</span>) </span>&#123;</span><br><span class="line">          bot.sendMessage(chatId, <span class="string">'Light is : '</span> + (lightSensorValue * <span class="number">100</span>) + <span class="string">'%'</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">        spamControlOn = <span class="literal">false</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>This small project we did it too simple but it was just to illustrate the concept nothing serious project was intended. But now that you have tools you could develop something more sophisticated by mashing up many sensors like temperature sensor, relay circuit etc. You could display Telegram message send by the user to 16x2 LCD display connected to Arduino sitting in your kitchen possibilities are limitless.</p><h3><span id="conclusion">Conclusion</span></h3><p>As you saw we implemented chat bot interacting with Arduino in few lines of code. All though the project is very simple, it’s clear that you don’t need to learn another language to program Arduino javascript is enough. Our entire project was in Nodejs but you could use any language of your choice, as there are Firmata protocol client libraries for many languages and also it’s not difficult to make Telegram bot REST API calls from the language of your choice you might even find a GitHub library for that as well. Happy Hacking!</p><h3><span id="useful-links">Useful links</span></h3><ol><li><a href="https://github.com/0xd3xt3r/blog-code/tree/master/when-chatbot-meets-arduino">Link to the source code used in this post</a></li><li><a href="https://github.com/firmata/arduino">List of Firmata client libraries</a></li><li><a href="https://github.com/firmata/protocol">Firmata protocol documentation</a></li><li><a href="https://core.telegram.org/bots#creating-a-new-bot">Creating telegram bot</a></li><li><a href="https://github.com/yagop/node-telegram-bot-api">Node telegram library documentation</a></li><li><a href="http://johnny-five.io/api/">johnny-five library documentation</a></li></ol></div><div class="article-tags size-small mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Arduino/">Arduino</a><a class="link-muted mr-2" rel="tag" href="/tags/Chat-Bots/">Chat Bots</a></div></article></div><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2017/09/25/implementing-knn-from-scratch-in-python/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">Implementing K-NearestNeighbour algorithm from scratch in python</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2017/07/31/twitter-bot-in-4-simple-steps/"><span class="level-item">Create a Twitter bot in 4 simple steps</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">Comments</h3><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config=function(){this.page.url="https://www.taintedbits.com/2017/08/20/when-a-chatbot-meets-arduino/",this.page.identifier="2017/08/20/when-a-chatbot-meets-arduino/"};!function(){var t=document,e=t.createElement("script");e.src="//taintedbits.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-4-widescreen order-1 is-sticky"><div class="card widget" id="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">Catalogue</h3><ul class="menu-list"><li><a class="is-flex" href="#"><span class="mr-2">1</span><span>Motivation</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">2</span><span>Software required</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">3</span><span>Hardware required</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">4</span><span>Basic project setup</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">5</span><span>Setting up Arduino for johnny-five</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">6</span><span>Setting up Telegram Bot</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">7</span><span>Hooking up Arduino with Chat Bot</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">8</span><span>Conclusion</span></a></li><li><a class="is-flex" href="#"><span class="mr-2">9</span><span>Useful links</span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><h3 class="menu-label">Recent</h3><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-17T18:30:00.000Z">2020-07-18</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/18/binary-exploitation-pwnable-tw-hacknote/">Binary Exploitation [pwnable.tw] - HackNote</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-17T18:30:00.000Z">2020-07-18</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/18/binary-exploitation-pwnable-tw-tcache-tear/">Binary Exploitation [pwnable.tw] - Tcache Tear</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-11T18:30:00.000Z">2020-07-12</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/12/binary-exploitation-pwnable-tw-caov/">Binary Exploitation [pwnable.tw] - CAOV</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-10T18:30:00.000Z">2020-07-11</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/11/binary-exploitation-pwnable-tw-spirited-away/">Binary Exploitation [pwnable.tw] - Spirited Away</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article><article class="media"><div class="media-content size-small"><p><time datetime="2020-07-04T18:30:00.000Z">2020-07-05</time></p><p class="title is-6"><a class="link-muted" href="/2020/07/05/binary-exploitation-pwnable-tw-realloc/">Binary Exploitation [pwnable.tw] - Realloc</a></p><p class="is-uppercase"><a class="link-muted" href="/categories/CTF-Writeups/">CTF Writeups</a></p></div></article></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Categories</h3><ul class="menu-list"><li><a class="level is-mobile is-marginless" href="/categories/Brain-Logs/"><span class="level-start"><span class="level-item">Brain Logs</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/CTF-Writeups/"><span class="level-start"><span class="level-item">CTF Writeups</span></span><span class="level-end"><span class="level-item tag">14</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Exploitation/"><span class="level-start"><span class="level-item">Exploitation</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/IOT/"><span class="level-start"><span class="level-item">IOT</span></span><span class="level-end"><span class="level-item tag">5</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Machine-Learning/"><span class="level-start"><span class="level-item">Machine Learning</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Malware-Analysis/"><span class="level-start"><span class="level-item">Malware Analysis</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/NLP/"><span class="level-start"><span class="level-item">NLP</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile is-marginless" href="/categories/Reverse-Engineering/"><span class="level-start"><span class="level-item">Reverse Engineering</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></div></div></div><div class="card widget"><div class="card-content"><div class="menu"><h3 class="menu-label">Tags</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/ACS712/"><span class="tag">ACS712</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Arduino/"><span class="tag">Arduino</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/CTF/"><span class="tag">CTF</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Chat-Bots/"><span class="tag">Chat Bots</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Classification/"><span class="tag">Classification</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Data-Wrangling/"><span class="tag">Data Wrangling</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dev/"><span class="tag">Dev</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Dropper/"><span class="tag">Dropper</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ESP8266/"><span class="tag">ESP8266</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Editor/"><span class="tag">Editor</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Emacs/"><span class="tag">Emacs</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Exploitation/"><span class="tag">Exploitation</span><span class="tag is-grey-lightest">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/GandCrab/"><span class="tag">GandCrab</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Grey-Energy/"><span class="tag">Grey Energy</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Heap-Exploitation/"><span class="tag">Heap Exploitation</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Kernel-Debugging/"><span class="tag">Kernel Debugging</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux/"><span class="tag">Linux</span><span class="tag is-grey-lightest">15</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Linux-Malware/"><span class="tag">Linux Malware</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Malware-Analysis/"><span class="tag">Malware Analysis</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Python/"><span class="tag">Python</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ROP/"><span class="tag">ROP</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Regression/"><span class="tag">Regression</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Reverse-Engineering/"><span class="tag">Reverse Engineering</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Visualization/"><span class="tag">Visualization</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/WarGames/"><span class="tag">WarGames</span><span class="tag is-grey-lightest">5</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Malware/"><span class="tag">Windows Malware</span><span class="tag is-grey-lightest">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/Windows-Reversing/"><span class="tag">Windows Reversing</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/glibc/"><span class="tag">glibc</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/javascript-obfuscation/"><span class="tag">javascript obfuscation</span><span class="tag is-grey-lightest">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable/"><span class="tag">pwnable</span><span class="tag is-grey-lightest">14</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-kr/"><span class="tag">pwnable-kr</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/pwnable-tw/"><span class="tag">pwnable-tw</span><span class="tag is-grey-lightest">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/radare2/"><span class="tag">radare2</span><span class="tag is-grey-lightest">4</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/images/logo-header.png" alt="D3xt3r&#039;s Laboratory" height="28"></a><p class="size-small"><span>&copy; 2020 D3xt3r</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by-nc-sa/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Subscribe" href="https://mailchi.mp/d744c1f04904/taintedbits"><i class="fa fa-envelope"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Download on GitHub" href="https://github.com/0xd3xt3r"><i class="fab fa-github"></i></a></p></div></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script>moment.locale("en")</script><script>var IcarusThemeSettings={site:{url:"https://www.taintedbits.com",external_link:{enable:!0,exclude:[]}},article:{highlight:{clipboard:!0,fold:"unfolded"}}}</script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" href="http://outdatedbrowser.com/">Update my browser now</a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://cdn.jsdelivr.net/npm/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load",function(){outdatedBrowser({bgColor:"#f25648",color:"#ffffff",lowerThan:"object-fit"})})</script><a id="back-to-top" title="Back to Top" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><script src="/js/main.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="Type something..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener("DOMContentLoaded",function(){loadInsight({contentUrl:"/content.json"},{hint:"Type something...",untitled:"(Untitled)",posts:"Posts",pages:"Pages",categories:"Categories",tags:"Tags"})})</script></body></html>